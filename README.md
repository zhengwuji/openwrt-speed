# openwrt-speed (LuCI App Proxy Upgrade)

## 📖 简介 (Introduction)
这是一个专为 OpenWrt 设计的 LuCI 插件，旨在解决 OpenWrt 系统在下载软件包或进行系统升级时速度慢、连接失败的问题。

通过本插件，您可以让 OpenWrt **"借用"** 局域网内其他设备（如运行 V2RayN、Clash 的 Windows 电脑）的代理网络，从而实现高速下载和更新。

## ✨ 功能特点 (Features)
- **🎨 可视化界面**: 无需 SSH 命令行，直接在 Web 界面配置所有参数。
- **🔍 智能发现**: 自动扫描并列出局域网内的设备 IP 和 MAC 地址，省去手动查找 IP 的麻烦。
- **⚡ 连接测试**: 提供一键 "测试连接" 功能，实时验证代理是否可用，并显示 HTTP 状态码。
- **⏱️ 自定义超时**: 支持设置连接测试的超时时间，避免长时间等待。
- **🌐 全局代理**: 支持将选定的代理服务器作为所有设备的出口网关（实验性功能）。
- **🔄 协议支持**: 完美支持 **HTTP** 和 **SOCKS5** 两种主流代理协议。
- **📜 实时日志**: 升级过程中，Web 界面会实时滚动显示详细的下载和安装日志。

## 📥 安装方法 (Installation)
1. 前往本仓库的 [Releases](https://github.com/zhengwuji/openwrt-speed/releases) 页面。
2. 下载最新版本的 `luci-app-proxy-upgrade_*.ipk` 文件。
3. 将文件上传到您的 OpenWrt 路由器（例如 `/tmp` 目录）。
4. 执行安装命令：
   ```bash
   opkg update
   opkg install /tmp/luci-app-proxy-upgrade_*.ipk
   ```
5. 安装完成后，刷新浏览器页面，在 **"系统"** 菜单下即可找到 **"代理升级"**。

## 🛠️ 使用教程 (Usage)

### 第一步：电脑端准备
确保您的电脑（或局域网内的其他代理设备）已运行代理软件，并开启了 **"允许局域网连接" (Allow LAN)** 功能。
- **V2RayN**: 设置 -> 参数设置 -> 勾选 "允许来自局域网的连接"。
- **Clash**: 开启 "Allow LAN"。

### 第二步：插件配置
1. 登录 OpenWrt 管理后台。
2. 进入菜单：**系统 (System)** -> **代理升级 (Proxy Upgrade)**。
3. **启用代理**: 选择 "启用"。
4. **代理服务器IP**: 点击下拉框，插件会自动列出局域网设备，选择您电脑的 IP 地址。
5. **代理端口**: 填写代理软件的局域网端口（例如 V2RayN 默认是 `10808`，Clash 默认是 `7890`）。
6. **代理类型**: 推荐选择 `SOCKS5`，也可以使用 `HTTP`。
7. **连接超时**: 设置测试连接的超时时间（默认 5 秒）。
8. **出口UI设置 (全局代理)**: 勾选此项后，所有连接到 OpenWrt 的设备都将通过您设置的代理 IP 上网。
   > ⚠️ **注意**: 这是一个高级功能，请确保您理解其含义。被选中的代理服务器 IP 本身不会受影响。

### 第三步：测试与升级
1. 点击 **"测试连接"** 按钮。
   - ✅ **成功**: 按钮旁显示绿色的 "连接成功 (HTTP 200)"。
   - ❌ **失败**: 显示红色的错误信息。
2. 测试通过后，点击右下角的 **"保存并应用"**。
3. 点击 **"开始升级"** 按钮。
4. 下方的日志框将开始滚动，显示 `opkg update` 和 `opkg upgrade` 的执行进度。

## ❓ 常见问题 (FAQ)

**Q: 点击 "测试连接" 提示失败怎么办？**
A: 请按以下顺序排查：
1. **防火墙**: 电脑的 Windows 防火墙可能会拦截入站连接。请尝试暂时关闭防火墙，或在防火墙中放行代理软件的端口。
2. **允许局域网**: 再次确认代理软件中是否开启了 "Allow LAN" 选项。
3. **IP变动**: 电脑的局域网 IP 可能会变化，建议在路由器中为电脑设置静态 DHCP 租约。

**Q: 开启 "出口UI设置" 后无法上网？**
A: 请检查代理服务器是否正常工作，以及代理端口是否正确。如果出现问题，请取消勾选该选项并保存，即可恢复默认路由。

---
**License**: MIT